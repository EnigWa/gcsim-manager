options swap_delay=12 iteration=1000;

klee char lvl=90/90 cons=0 talent=9,9,9;
klee add weapon="dodocotales" refine=5 lvl=90/90;
klee add set="mh" count=4;
klee add stats hp=4780 atk=311 atk%=0.466 atk%=0.466 cr=0.311; #main
klee add stats def%=0.124 def=39.36 hp=507.88 hp%=0.0992 atk=33.08 atk%=0.248 er=0.1653 em=39.64 cr=0.2648 cd=0.7944;

chiori char lvl=90/90 cons=0 talent=9,9,9;
#chiori add weapon="cinnabar" refine=5 lvl=90/90; # This is her second best option among the weapons listed, even at c1. Wolf Fang is about equal at c0
#chiori add weapon="harbinger" refine=5 lvl=90/90;
#chiori add weapon="ezpitzal" refine=5 lvl=90/90;
chiori add weapon="wolffang" refine=1 lvl=90/90;
#chiori add set="gt" count=4;
chiori add set="husk" count=4 +params=[stacks=4];
#chiori add stats hp=4780 atk=311 def%=0.583 geo%=0.466 cr=0.311 ; # main
#chiori add stats def%=0.248 def=39.36 hp=507.88 hp%=0.0992 atk=33.08 atk%=0.0992 er=0.1102 em=39.64 cr=0.331 cd=0.7944;
#chiori add stats hp=4780 atk=311 def%=0.583 geo%=0.466 cd=0.622 ; #main#
#chiori add stats def%=0.248 def=39.36 hp=507.88 hp%=0.0992 atk=33.08 atk%=0.0992 er=0.1102 em=39.64 cr=0.3972 cd=0.662; # HoD
chiori add stats hp=4780 atk=311 def%=0.583 geo%=0.466 cd=0.622;
chiori add stats def%=0.248 def=39.36 hp=507.88 hp%=0.0992 atk=33.08 atk%=0.0992 er=0.1102 em=39.64 cr=0.3972 cd=0.662;

xilonen char lvl=90/90 cons=0 talent=9,9,9; 
xilonen add weapon="favsword" refine=5 lvl=90/90;
xilonen add set="scroll" count=4;
xilonen add stats hp=4780 atk=311 def%=0.583 def%=0.583 cr=0.311;
xilonen add stats def%=0.248 def=39.36 hp=507.88 hp%=0.0992 atk=33.08 atk%=0.0992 er=0.1102 em=39.64 cr=0.331 cd=0.7944;

furina char lvl=90/90 cons=0 talent=9,9,9;
furina add weapon="festering" refine=5 lvl=90/90;
furina add set="gt" count=4;
furina add stats hp=4780 atk=311 hp%=0.466 hp%=0.466 cd=0.622; #main
furina add stats def%=0.124 def=39.36 hp=507.88 hp%=0.1984 atk=33.08 atk%=0.0992 er=0.1102 em=39.64 cr=0.3972 cd=0.662;

# Target
target lvl=100 resist=0.1 radius=2 pos=0,2.4 hp=999999999; 
energy every interval=480,720 amount=1;

# Klee Combo
fn klee_combo(x) {
  klee attack, charge, burst, walk;
  klee attack[travel=6]:2, skill[bounce=3, mine=8], jump;
  if .klee.skill.ready {
    klee attack, skill[bounce=3, mine=8], jump;
  } else {
    klee attack[travel=6], charge;
  }
  for let x = 4; x > 0; x = x - 1 {
    klee attack[travel=6], charge; # Klee 4N1C
  }
  klee attack, walk, attack;
}

# Pickup Crystallize Function
let _execute_action = execute_action;
fn execute_action(char_id number, action_id number, p map) {
  if action_id == .action.dash || ( char_id == .keys.char.xilonen && action_id == .action.skill ) || ( char_id == .keys.char.chiori && action_id == .action.skill ) {
    pick_up_crystallize("any");
  }
    
  return _execute_action(char_id, action_id, p);
}

# Rotation
active klee;
klee attack; #initial pyro lets xylophone scroll pyro in the first rotation
for let i=0; i<4; i=i+1 {
  xilonen skill, attack:2, burst;
  furina skill, dash, burst;
  chiori burst, skill:2;
  xilonen skill, attack:2;
  klee_combo(0);
}
